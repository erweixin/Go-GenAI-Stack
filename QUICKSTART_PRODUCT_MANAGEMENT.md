# 商品管理功能快速启动指南

## 📋 前提条件

1. ✅ Docker 已安装并运行
2. ✅ Go 1.21+ 已安装
3. ✅ Node.js 20+ 和 pnpm 已安装
4. ✅ 数据库迁移已完成

## 🚀 启动步骤

### 1. 启动数据库（如果还没有运行）

```bash
cd docker
docker-compose up -d
```

### 2. 应用数据库迁移

```bash
cd ../backend/database
make diff NAME=add_product_domain  # 生成迁移（如果还没有生成）
make apply                          # 应用迁移
```

### 3. 启动后端服务

```bash
cd ../backend
go run cmd/api/main.go
```

后端将在 `http://localhost:8082` 启动

### 4. 启动前端开发服务器

```bash
cd ../../frontend
pnpm install  # 确保依赖已安装

cd web
pnpm dev
```

前端将在 `http://localhost:5173` 启动

## 🌐 访问商品管理

### 方式一：从首页访问

1. 打开浏览器访问 `http://localhost:5173`
2. 登录（如果还没有账号，先注册）
3. 在首页点击 **"商品管理"** 卡片

### 方式二：直接访问

直接访问 `http://localhost:5173/products`（需要先登录）

## 🎯 功能演示

### 创建商品

1. 点击右上角 **"新建商品"** 按钮
2. 填写表单：
   - **商品名称**：例如 "iPhone 15 Pro"（必填）
   - **商品图片 URL**：可选，会显示预览
   - **商品描述**：可选
   - **兑换所需金币**：例如 1000（必填，必须 > 0）
   - **金币类型**：选择金币或银币
   - **总库存**：例如 50（必填，>= 0）
   - **每人购买限制**：可选，例如 2
   - **成本**：可选，例如 5999.00
3. 点击 **"创建"** 按钮

### 编辑商品

1. 在商品列表中找到要编辑的商品
2. 点击 **编辑图标**（铅笔图标）
3. 修改字段（注意：库存不能小于已兑换数量）
4. 点击 **"保存"** 按钮

### 上架商品

1. 找到状态为 **"下架"** 的商品
2. 点击 **上架图标**（向上箭头图标）
3. 在弹出的对话框中输入 **上架数量**（不能超过总库存）
4. 点击 **"确认上架"** 按钮

### 下架商品

1. 找到状态为 **"上架"** 的商品
2. 点击 **下架图标**（向下箭头图标）
3. 商品将立即下架

### 删除商品

1. 找到状态为 **"下架"** 且 **已兑换数量为 0** 的商品
2. 点击 **删除图标**（垃圾桶图标）
3. 在确认对话框中点击 **"删除"** 按钮

> ⚠️ 注意：只有下架且未被兑换的商品才能删除

### 筛选和搜索

- **关键词搜索**：在搜索框中输入商品名称
- **状态筛选**：选择 "全部状态" / "上架" / "下架"
- **排序**：选择排序方式（创建时间、更新时间、金币数、兑换数量）

### 分页

- 使用底部的 **"上一页"** / **"下一页"** 按钮浏览
- 显示当前页码和总数据量

## 📊 商品表格字段说明

| 字段 | 说明 |
|------|------|
| 序号 | 当前页的序号 |
| 图片 | 商品图片缩略图 |
| 商品名称 | 商品名称和描述 |
| 金币/类型 | 兑换所需金币和类型（金币/银币） |
| 库存 | 总库存数量 |
| 上架 | 已上架数量 |
| 已兑换 | 已被用户兑换的数量 |
| 剩余 | 线上剩余 = 上架数量 - 已兑换 |
| 成本/收益 | 成本和已兑换收益 |
| 状态 | 上架/下架 |
| 操作时间 | 最后更新时间 |
| 操作 | 编辑、上架/下架、删除按钮 |

## 🔔 通知提示

所有操作都会显示 Toast 通知：
- ✅ 成功：绿色通知
- ❌ 失败：红色通知，包含错误信息

## 🎨 UI 特性

- 🌓 **深色模式**：点击右上角月亮/太阳图标切换
- 📱 **响应式设计**：支持各种屏幕尺寸
- 🎯 **直观操作**：图标化按钮，操作清晰
- 🚀 **快速响应**：使用 React Query 自动缓存和刷新

## 🛠️ 常见问题

### Q: 创建商品后看不到？
A: 确保后端服务正在运行，并检查浏览器控制台是否有错误

### Q: 图片不显示？
A: 检查图片 URL 是否有效，支持 HTTPS 或 HTTP 协议

### Q: 无法上架商品？
A: 确保上架数量不超过总库存

### Q: 无法删除商品？
A: 只有下架且已兑换数量为 0 的商品才能删除

### Q: 修改库存时提示错误？
A: 库存不能小于已兑换数量

## 📚 API 端点

后端 API 端点（可用 curl 测试）：

```bash
# 列出商品
curl http://localhost:8082/api/products

# 创建商品
curl -X POST http://localhost:8082/api/products \
  -H "Content-Type: application/json" \
  -d '{
    "name": "测试商品",
    "initial_coins": 100,
    "coin_type": "gold",
    "stock": 50
  }'

# 获取单个商品
curl http://localhost:8082/api/products/{id}

# 更新商品
curl -X PUT http://localhost:8082/api/products/{id} \
  -H "Content-Type: application/json" \
  -d '{"name": "更新后的名称"}'

# 上架商品
curl -X POST http://localhost:8082/api/products/{id}/shelve \
  -H "Content-Type: application/json" \
  -d '{"quantity": 10}'

# 下架商品
curl -X POST http://localhost:8082/api/products/{id}/unshelve

# 删除商品
curl -X DELETE http://localhost:8082/api/products/{id}
```

## 🎉 完成！

现在你可以使用完整的商品管理功能了！

如有问题，请查看：
- 后端日志：`backend/` 目录运行日志
- 前端控制台：浏览器开发者工具
- 数据库：使用 `psql` 或数据库客户端查看 `products` 表

