# E2E æµ‹è¯•

ç«¯åˆ°ç«¯ï¼ˆEnd-to-Endï¼‰æµ‹è¯•ï¼Œä½¿ç”¨ Playwright æ¡†æ¶ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ 1ï¼šä¸€é”®è¿è¡Œï¼ˆæ¨èï¼‰â­

```bash
# åœ¨ frontend/web ç›®å½•
pnpm e2e:all
```

ä¸€æ¡å‘½ä»¤å®Œæˆï¼šå¯åŠ¨ Docker ç¯å¢ƒ â†’ è¿è¡Œæµ‹è¯• â†’ æ¸…ç†ç¯å¢ƒ

### æ–¹å¼ 2ï¼šæ‰‹åŠ¨æ§åˆ¶

#### 1. å®‰è£… Playwright æµè§ˆå™¨ï¼ˆé¦–æ¬¡ï¼‰

```bash
pnpm playwright:install
```

#### 2. å¯åŠ¨ E2E ç¯å¢ƒï¼ˆDockerï¼‰

```bash
# åœ¨ frontend/web ç›®å½•
pnpm e2e:setup

# æˆ–åœ¨é¡¹ç›®æ ¹ç›®å½•
./docker/e2e/start.sh
```

è¿™ä¼šå¯åŠ¨ï¼š
- âœ… Postgres æ•°æ®åº“ï¼ˆlocalhost:5433ï¼‰
- âœ… åç«¯æœåŠ¡å™¨ï¼ˆhttp://localhost:8081ï¼‰
- âœ… é¢„ç½®æµ‹è¯•ç”¨æˆ·å’Œæ•°æ®

#### 3. è¿è¡Œ E2E æµ‹è¯•

```bash
# åœ¨ frontend/web ç›®å½•
pnpm e2e              # è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm e2e:ui           # UI æ¨¡å¼ï¼ˆæ¨èï¼Œå¯è§†åŒ–è°ƒè¯•ï¼‰â­
pnpm e2e:headed       # æœ‰å¤´æ¨¡å¼ï¼ˆæ˜¾ç¤ºæµè§ˆå™¨ï¼‰
pnpm e2e:debug        # è°ƒè¯•æ¨¡å¼
```

#### 4. åœæ­¢ E2E ç¯å¢ƒ

```bash
# åœæ­¢ä½†ä¿ç•™æ•°æ®
pnpm e2e:teardown

# åœæ­¢å¹¶æ¸…ç†æ‰€æœ‰æ•°æ®
pnpm e2e:clean
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
e2e/
â”œâ”€â”€ auth/                       # è®¤è¯æµç¨‹æµ‹è¯•
â”‚   â”œâ”€â”€ login.spec.ts           # ç™»å½•æµ‹è¯•
â”‚   â””â”€â”€ register.spec.ts        # æ³¨å†Œæµ‹è¯•
â”œâ”€â”€ task/                       # ä»»åŠ¡ç®¡ç†æµ‹è¯•
â”‚   â”œâ”€â”€ create-task.spec.ts     # åˆ›å»ºä»»åŠ¡
â”‚   â”œâ”€â”€ task-operations.spec.ts # ä»»åŠ¡æ“ä½œï¼ˆç¼–è¾‘ã€åˆ é™¤ã€å®Œæˆï¼‰
â”‚   â””â”€â”€ task-flow.spec.ts       # å®Œæ•´æµç¨‹æµ‹è¯•
â”œâ”€â”€ fixtures/                   # æµ‹è¯•æ•°æ®
â”‚   â””â”€â”€ test-data.ts
â””â”€â”€ helpers/                    # è¾…åŠ©å‡½æ•°
    â”œâ”€â”€ auth-helpers.ts
    â””â”€â”€ task-helpers.ts
```

---

## ğŸ§ª æµ‹è¯•è¦†ç›–

### Auth Flowï¼ˆè®¤è¯æµç¨‹ï¼‰
- âœ… æˆåŠŸç™»å½•
- âœ… é”™è¯¯å‡­æ®ç™»å½•
- âœ… è¡¨å•éªŒè¯
- âœ… ç™»å‡º
- âœ… æˆåŠŸæ³¨å†Œ
- âœ… é‚®ç®±å·²å­˜åœ¨
- âœ… å¯†ç éªŒè¯
- âœ… é¡µé¢å¯¼èˆª

### Task Flowï¼ˆä»»åŠ¡æµç¨‹ï¼‰
- âœ… åˆ›å»ºåŸºæœ¬ä»»åŠ¡
- âœ… åˆ›å»ºé«˜ä¼˜å…ˆçº§ä»»åŠ¡
- âœ… åˆ›å»ºå¸¦æ ‡ç­¾ä»»åŠ¡
- âœ… ç¼–è¾‘ä»»åŠ¡
- âœ… å®Œæˆä»»åŠ¡
- âœ… åˆ é™¤ä»»åŠ¡
- âœ… ä»»åŠ¡ç­›é€‰
- âœ… å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
- âœ… è·¯ç”±ä¿æŠ¤

**æ€»è®¡**: 17+ ä¸ª E2E æµ‹è¯•ç”¨ä¾‹

---

## ğŸ”§ é…ç½®

### playwright.config.ts

- **æµ‹è¯•ç›®å½•**: `./e2e`
- **è¶…æ—¶æ—¶é—´**: 30 ç§’
- **å¤±è´¥é‡è¯•**: CI ç¯å¢ƒ 2 æ¬¡
- **æµè§ˆå™¨**: Chromiumï¼ˆé»˜è®¤ï¼‰
- **æˆªå›¾**: ä»…å¤±è´¥æ—¶
- **è§†é¢‘**: ä»…å¤±è´¥æ—¶ä¿ç•™

### ç¯å¢ƒå˜é‡

åˆ›å»º `.env.e2e` æ–‡ä»¶ï¼š

```bash
VITE_API_BASE_URL=http://localhost:8080
E2E_BASE_URL=http://localhost:5173
```

---

## ğŸ“ æµ‹è¯•æœ€ä½³å®è·µ

### 1. ä½¿ç”¨è¾…åŠ©å‡½æ•°

```typescript
import { loginAsTestUser } from '../helpers/auth-helpers'

test('my test', async ({ page }) => {
  await loginAsTestUser(page)  // ä½¿ç”¨è¾…åŠ©å‡½æ•°ç™»å½•
  // ...
})
```

### 2. ä½¿ç”¨æµ‹è¯•æ•°æ®

```typescript
import { testTasks } from '../fixtures/test-data'

await page.fill('input', testTasks.basic.title)
```

### 3. ä½¿ç”¨æ˜ç¡®çš„é€‰æ‹©å™¨

```typescript
// âœ… å¥½
await page.click('button[data-testid="create-task"]')

// âŒ å·®
await page.click('button')
```

### 4. ç­‰å¾…å…ƒç´ 

```typescript
// âœ… è‡ªåŠ¨ç­‰å¾…
await expect(page.locator('text=Success')).toBeVisible()

// âŒ å›ºå®šå»¶è¿Ÿ
await page.waitForTimeout(3000)
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. ä½¿ç”¨ UI æ¨¡å¼

```bash
pnpm e2e:ui
```

å¯è§†åŒ–ç•Œé¢ï¼Œå¯ä»¥ï¼š
- çœ‹åˆ°æ¯ä¸ªæ­¥éª¤çš„æ‰§è¡Œ
- æŸ¥çœ‹æˆªå›¾
- æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
- é€æ­¥è°ƒè¯•

### 2. ä½¿ç”¨è°ƒè¯•æ¨¡å¼

```bash
pnpm e2e:debug
```

### 3. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š

```bash
pnpm exec playwright show-report
```

### 4. æˆªå›¾å’Œè§†é¢‘

å¤±è´¥çš„æµ‹è¯•ä¼šè‡ªåŠ¨ä¿å­˜ï¼š
- æˆªå›¾ï¼š`test-results/`
- è§†é¢‘ï¼š`test-results/`
- HTML æŠ¥å‘Šï¼š`playwright-report/`

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### æµ‹è¯•æ•°æ®

E2E æµ‹è¯•ä½¿ç”¨ Docker éš”ç¦»ç¯å¢ƒï¼š

1. **æµ‹è¯•ç”¨æˆ·**ï¼šè‡ªåŠ¨åˆ›å»º `e2e-test@example.com`ï¼ˆå¯†ç ï¼š`Test123456!`ï¼‰
2. **æµ‹è¯•æ•°æ®åº“**ï¼šç‹¬ç«‹çš„ Postgres å®ä¾‹ï¼ˆç«¯å£ 5433ï¼‰
3. **æ•°æ®æ¸…ç†**ï¼šä½¿ç”¨ `pnpm e2e:clean` å®Œå…¨æ¸…ç†

### å¹¶å‘é—®é¢˜

- CI ç¯å¢ƒè®¾ç½®ä¸ºä¸²è¡Œæ‰§è¡Œï¼ˆ`workers: 1`ï¼‰
- é¿å…æµ‹è¯•é—´æ•°æ®å†²çª

---

## ğŸ“Š CI/CD

E2E æµ‹è¯•åœ¨ GitHub Actions ä¸­è‡ªåŠ¨è¿è¡Œï¼š

- âœ… è‡ªåŠ¨å¯åŠ¨ Postgres æ•°æ®åº“
- âœ… è‡ªåŠ¨å¯åŠ¨åç«¯æœåŠ¡å™¨
- âœ… è‡ªåŠ¨å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
- âœ… è¿è¡Œ E2E æµ‹è¯•
- âœ… ä¸Šä¼ æµ‹è¯•æŠ¥å‘Šï¼ˆå¤±è´¥æ—¶ï¼‰
- âœ… ä¸Šä¼ è§†é¢‘ï¼ˆå¤±è´¥æ—¶ï¼‰

æŸ¥çœ‹é…ç½®ï¼š`.github/workflows/frontend-e2e.yml`

---

## ğŸ”— ç›¸å…³èµ„æº

- [Playwright æ–‡æ¡£](https://playwright.dev/)
- [æµ‹è¯•æ–¹æ¡ˆ](../../docs/FRONTEND_E2E_PLAN.md)
- [å‰ç«¯ README](../README.md)

---

**ç»´æŠ¤è€…**: AI Assistant  
**æœ€åæ›´æ–°**: 2025-11-27

